<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tratamento de Dados — Upload</title>

  <style>
    /* ====== Design tokens (corporate, clean) ======= */
    :root{
      --bg:#f4f6f8;
      --surface:#ffffff;
      --muted:#6b7280;
      --text:#0f1724;
      --primary:#0b5fff;
      --primary-600:#084fcc;
      --border:#e6eef8;
      --success:#10b981;
      --danger:#ef4444;
      --shadow: 0 6px 18px rgba(12, 20, 36, 0.06);
      --radius:10px;
      --glass: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,250,0.9));
      font-size:16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }

    .wrap{ max-width:980px; margin:36px auto; padding:24px; }

    header.appbar{
      display:flex; align-items:center; gap:16px;
      padding:18px 24px; background:var(--surface);
      border-radius:12px; box-shadow:var(--shadow); border:1px solid var(--border);
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .brand-logo{ width:44px; height:44px; background:linear-gradient(180deg,var(--primary),var(--primary-600));
      border-radius:8px; display:flex; align-items:center; justify-content:center; color:white; font-weight:700;
      box-shadow:0 4px 12px rgba(11,95,255,0.15);
    }
    .brand-title{ font-weight:600; font-size:1.0625rem; }
    .brand-sub{ font-size:0.875rem; color:var(--muted); }

    main.card{ margin-top:20px; background:var(--surface); border-radius:var(--radius); border:1px solid var(--border);
      box-shadow:var(--shadow); overflow:hidden; }

    .card-header{ padding:20px 24px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
    .card-header h1{ font-size:1.0625rem; margin:0; font-weight:600; }
    .card-header p{ margin:0; color:var(--muted); font-size:0.875rem; }

    .card-body{ padding:26px; }

    /* ===== SELETOR DE TIPO =====  */
    .type-selector{ 
      display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:16px; margin-bottom:24px;
    }
    .type-option{
      position:relative;
    }
    .type-option input{ position:absolute; opacity:0; cursor:pointer; }
    .type-label{
      display:flex; flex-direction:column; align-items:flex-start; gap:8px; padding:18px; border-radius:12px; border:2px solid var(--border);
      background:var(--surface); cursor:pointer; transition:all .2s ease; height:100%; justify-content:space-between;
    }
    .type-option input:checked + .type-label{
      border-color:var(--primary); background:rgba(11,95,255,0.04); box-shadow:0 4px 16px rgba(11,95,255,0.12); transform:translateY(-2px);
    }
    .type-radio{ width:24px; height:24px; border-radius:50%; border:2px solid var(--border); flex-shrink:0; transition:all .2s ease; }
    .type-option input:checked + .type-label .type-radio{ border-color:var(--primary); background:var(--primary); box-shadow:0 0 0 4px rgba(11,95,255,0.1); }
    .type-info{ width:100%; }
    .type-info h3{ margin:0; font-weight:700; font-size:1rem; }
    .type-info p{ margin:6px 0 0; color:var(--muted); font-size:0.85rem; line-height:1.4; }

    .upload-area{
      border-radius:12px; border:1px dashed var(--border); padding:30px; display:flex; gap:20px; align-items:center;
      background:var(--glass); transition:all .16s ease; cursor:pointer; position:relative;
    }
    .upload-area.hover{ box-shadow:0 6px 18px rgba(11,95,255,0.06); border-color:var(--primary); transform:translateY(-2px); }
    .upload-icon{ width:64px; height:64px; display:flex; align-items:center; justify-content:center; border-radius:10px;
      background:linear-gradient(180deg, rgba(11,95,255,0.09), rgba(11,95,255,0.04)); flex-shrink:0; }
    .upload-icon svg{ width:32px; height:32px; color:var(--primary); display:block; }

    .upload-info{ flex:1; }
    .upload-info h2{ margin:0; font-size:1.0625rem; font-weight:600; }
    .upload-info p{ margin:6px 0 0; color:var(--muted); font-size:0.95rem }
    .file-types{ margin-top:8px; color:var(--muted); font-size:0.85rem }

    .controls{ margin-top:18px; display:flex; gap:12px; align-items:center; justify-content:flex-end; }

    /* Buttons - subtle interactive and predictable layout */
    .btn{
      padding:10px 14px; border-radius:8px; border:1px solid transparent; background:transparent;
      cursor:pointer; font-weight:600; display:inline-flex; gap:8px; align-items:center;
      transition:transform .12s ease, box-shadow .12s ease, background-color .12s ease, opacity .12s ease;
      vertical-align:middle; text-decoration:none;
    }
    .btn:focus{ outline:3px solid rgba(11,95,255,0.12); outline-offset:2px }
    .btn:hover{ transform:translateY(-3px); box-shadow:0 10px 18px rgba(12,20,36,0.06) }
    .btn:active{ transform:translateY(-1px) scale(.995); opacity:.98 }

    .btn.primary{ background:var(--primary); color:white; border-color:transparent; box-shadow:0 6px 12px rgba(11,95,255,0.08); }
    .btn.ghost{ background:#fff; color:var(--text); border:1px solid var(--border); }

    .btn svg{ display:inline-block; width:16px; height:16px; flex-shrink:0; }
    .btn .btn-label{ display:inline-block; line-height:1; }

    .btn:disabled{ opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none }

    .files-list{ margin-top:18px }
    .files-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:12px; }
    .file-card{ background:transparent; border-radius:10px; padding:12px; display:flex; gap:12px; align-items:center; border:1px solid var(--border);
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease; }
    .file-card:hover{ transform:translateY(-4px); box-shadow:0 8px 20px rgba(12,20,36,0.05); border-color:rgba(11,95,255,0.06) }
    .file-thumb{ width:44px; height:44px; border-radius:8px; background:linear-gradient(180deg,rgba(16,185,129,0.06),rgba(16,185,129,0.02));
      display:flex; align-items:center; justify-content:center; color:var(--success); flex-shrink:0; }
    .file-meta{ flex:1; min-width:0 }
    .file-name{ font-weight:600; font-size:0.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .file-size{ color:var(--muted); font-size:0.85rem; margin-top:4px }

    .file-actions{ display:flex; gap:8px; align-items:center }
    .icon-btn{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; border-radius:8px; border:1px solid transparent;
      background:transparent; cursor:pointer; transition:transform .12s ease, background-color .12s ease, border-color .12s ease; }
    .icon-btn:hover{ background:rgba(11,95,255,0.04); transform:translateY(-2px) }
    .icon-btn.danger{ border-color:rgba(239,68,68,0.08); color:var(--danger) }

    .processing{ padding:36px; text-align:center; }
    .spinner{ margin:0 auto 18px; width:72px;height:72px;border-radius:50%; border:6px solid var(--border); border-top-color:var(--primary); animation:spin 1.05s linear infinite; }
    @keyframes spin{ to{ transform:rotate(360deg)} }
    .processing h3{ margin:8px 0 0; font-size:1.125rem; font-weight:700 }
    .processing p{ margin:8px 0 0; color:var(--muted) }

    .results{ padding:22px; }
    .results-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:12px; }
    .result-item{ padding:12px; border-radius:10px; border:1px solid var(--border); display:flex; gap:12px; align-items:center; justify-content:space-between; }
    .result-meta{ display:flex; gap:12px; align-items:center; min-width:0 }
    .result-thumb{ width:44px;height:44px;border-radius:8px;background:linear-gradient(180deg,rgba(59,130,246,0.06),rgba(59,130,246,0.02)); display:flex;align-items:center;justify-content:center;color:var(--primary); }
    .result-name{ font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .result-size{ color:var(--muted); font-size:0.85rem }

    @media (max-width:720px){ .files-grid,.results-grid{ grid-template-columns:1fr } .controls{ flex-direction:column; align-items:stretch } }

    .visually-hidden{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px, 1px, 1px, 1px); white-space:nowrap; border:0; padding:0; margin:-1px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="appbar" role="banner">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M14 3H6a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V9l-6-6z" fill="white"/>
            <path d="M14 3v6h6" fill="rgba(255,255,255,0.14)"/>
          </svg>
        </div>
        <div>
          <div class="brand-title">Tratamento de Dados</div>
          <div class="brand-sub">Processamento corporativo de planilhas</div>
        </div>
      </div>
    </header>

    <main class="card" role="main" aria-live="polite">
      <!-- Type Selection Screen -->
      <section id="typeScreen">
        <div class="card-header">
          <div>
            <h1>Selecione o tipo de relatório</h1>
            <p>Escolha qual tipo de processamento deseja realizar</p>
          </div>
        </div>
        <div class="card-body">
          <div class="type-selector">
            <div class="type-option">
              <input type="radio" id="type-recebido" name="reportType" value="recebido" checked>
              <label for="type-recebido" class="type-label">
                <div class="type-radio"></div>
                <div class="type-info">
                  <h3>Internação - Recebido</h3>
                  <p>Processamento de recebimentos</p>
                </div>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" id="type-entrega" name="reportType" value="entrega">
              <label for="type-entrega" class="type-label">
                <div class="type-radio"></div>
                <div class="type-info">
                  <h3>Internação - Entrega</h3>
                  <p>Processamento de entregas</p>
                </div>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" id="type-carga" name="reportType" value="carga">
              <label for="type-carga" class="type-label">
                <div class="type-radio"></div>
                <div class="type-info">
                  <h3>Carga Nacional</h3>
                  <p>Recebimento e Entrega</p>
                </div>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" id="type-exportacao" name="reportType" value="exportacao">
              <label for="type-exportacao" class="type-label">
                <div class="type-radio"></div>
                <div class="type-info">
                  <h3>Exportação - Recebido</h3>
                  <p>Processamento de exportações recebidas</p>
                </div>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" id="type-exportacao-entrega" name="reportType" value="exportacao-entrega">
              <label for="type-exportacao-entrega" class="type-label">
                <div class="type-radio"></div>
                <div class="type-info">
                  <h3>Exportação - Entrega</h3>
                  <p>Processamento de exportações entregues</p>
                </div>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" id="type-liberacao" name="reportType" value="liberacao">
              <label for="type-liberacao" class="type-label">
                <div class="type-radio"></div>
                <div class="type-info">
                  <h3>Liberação - Entrega</h3>
                  <p>Processamento de liberações</p>
                </div>
              </label>
            </div>
          </div>
          <div class="controls">
            <button id="btnContinue" class="btn primary">
              <span class="btn-label">Continuar</span>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>
      </section>

      <!-- Upload Screen -->
      <section id="uploadScreen" style="display:none">
        <div class="card-header">
          <div>
            <h1>Carregar arquivos</h1>
            <p id="uploadSubtitle">Selecione até 8 arquivos .xlsx ou .xls para processamento</p>
          </div>
          <div><div id="counterBadge" style="text-align:right; color:var(--muted); font-weight:600">0 / 8</div></div>
        </div>

        <div class="card-body">
          <div id="uploadArea" class="upload-area" tabindex="0" role="button" aria-label="Clique ou arraste arquivos para enviar">
            <div class="upload-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)">
                <path d="M16 16l-4-4-4 4" />
                <path d="M12 12v8" />
                <path d="M20.39 16.61A5 5 0 0017 10h-1.26A8 8 0 104 16.29" />
              </svg>
            </div>

            <div class="upload-info">
              <h2 id="uploadTitle">Arraste e solte arquivos</h2>
              <p>Arraste os arquivos para cá ou clique para selecionar.</p>
              <div class="file-types">Formatos aceitos: .xlsx, .xls — Máximo 8 arquivos</div>
            </div>

            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
              <label id="btnChoose" class="btn ghost" for="fileInput" title="Selecionar arquivos" role="button" aria-label="Selecionar arquivos">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
                <span class="btn-label">Selecionar arquivos</span>
              </label>
              <input id="fileInput" type="file" multiple accept=".xlsx,.xls" class="visually-hidden">
            </div>
          </div>

          <div id="filesList" class="files-list" style="display:none">
            <div style="margin-bottom:12px; color:var(--muted); font-size:0.9rem">
              <span id="filesCount"></span>
            </div>
            <div id="filesGrid" class="files-grid"></div>
          </div>

          <div class="controls">
            <button id="btnCancel" class="btn ghost" type="button">
              <span class="btn-label">Voltar</span>
            </button>
            <button id="btnProcess" class="btn primary" type="button" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="M7 10l5 5 5-5"/><path d="M12 15V3"/></svg>
              <span class="btn-label">Enviar para processamento</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Processing Screen -->
      <section id="processingScreen" style="display:none">
        <div class="processing">
          <div class="spinner" aria-hidden="true"></div>
          <h3 id="processingTitle">Processando</h3>
          <p id="processingSubtitle">Aguarde...</p>
        </div>
      </section>

      <!-- Results Screen -->
      <section id="resultsScreen" style="display:none">
        <div class="card-header">
          <div>
            <h1 id="resultsTitle">Resultados</h1>
            <p id="resultsSubtitle"></p>
          </div>
        </div>
        <div class="results">
          <div id="resultsGrid" class="results-grid"></div>
          <div style="margin-top:18px; display:flex; gap:8px">
            <button id="btnNewUpload" class="btn ghost" type="button">
              <span class="btn-label">Novo envio</span>
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const filesList = document.getElementById('filesList');
    const filesGrid = document.getElementById('filesGrid');
    const filesCount = document.getElementById('filesCount');
    const counterBadge = document.getElementById('counterBadge');
    const btnProcess = document.getElementById('btnProcess');
    const btnCancel = document.getElementById('btnCancel');
    const btnNewUpload = document.getElementById('btnNewUpload');
    const btnContinue = document.getElementById('btnContinue');
    const btnChoose = document.getElementById('btnChoose');
    const processingScreen = document.getElementById('processingScreen');
    const processingTitle = document.getElementById('processingTitle');
    const processingSubtitle = document.getElementById('processingSubtitle');
    const resultsScreen = document.getElementById('resultsScreen');
    const resultsTitle = document.getElementById('resultsTitle');
    const resultsSubtitle = document.getElementById('resultsSubtitle');
    const resultsGrid = document.getElementById('resultsGrid');
    const typeScreen = document.getElementById('typeScreen');
    const uploadScreen = document.getElementById('uploadScreen');

    let selectedFiles = [];
    let processedFile = null;
    let objectUrl = null;
    let selectedReportType = 'recebido';

    const URLs = {
      recebido: 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/processar-8-arquivos',
      entrega: 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/processar-8-arquivos',
      carga: 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/processar-8-arquivos',
      exportacao: 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/processar-8-arquivos',
      'exportacao-entrega': 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/processar-8-arquivos',
      liberacao: 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/liberação'
    };

    // Type selection
    btnContinue.addEventListener('click', () => {
      selectedReportType = document.querySelector('input[name="reportType"]:checked').value;
      showUpload();
    });

    // Upload events
    fileInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files).slice(0, 8 - selectedFiles.length);
      selectedFiles = [...selectedFiles, ...files];
      fileInput.value = '';
      renderFilesList();
    });

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('hover');
    });

    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('hover'));

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('hover');
      const files = Array.from(e.dataTransfer.files).slice(0, 8 - selectedFiles.length);
      selectedFiles = [...selectedFiles, ...files];
      renderFilesList();
    });

    uploadArea.addEventListener('click', (e) => {
      if (e.target !== fileInput && !btnChoose.contains(e.target) && e.target !== btnChoose) {
        fileInput.click();
      }
    });

    btnCancel.addEventListener('click', () => {
      selectedFiles = [];
      fileInput.value = '';
      renderFilesList();
      showTypeSelection();
    });

    btnProcess.addEventListener('click', startProcessing);

    btnNewUpload.addEventListener('click', () => {
      selectedFiles = [];
      processedFile = null;
      fileInput.value = '';
      renderFilesList();
      showTypeSelection();
    });

    function renderFilesList(){
      const hasFiles = selectedFiles.length > 0;
      filesList.style.display = hasFiles ? 'block' : 'none';
      btnProcess.disabled = !hasFiles;
      filesCount.textContent = `${selectedFiles.length} arquivo${selectedFiles.length !== 1 ? 's' : ''} selecionado${selectedFiles.length !== 1 ? 's' : ''}`;
      counterBadge.textContent = `${selectedFiles.length} / 8`;

      filesGrid.innerHTML = '';
      selectedFiles.forEach((file, idx) => {
        const card = document.createElement('div');
        card.className = 'file-card';

        const thumb = document.createElement('div');
        thumb.className = 'file-thumb';
        thumb.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" style="color:var(--success)"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>';

        const meta = document.createElement('div');
        meta.className = 'file-meta';

        const name = document.createElement('div');
        name.className = 'file-name';
        name.title = file.name;
        name.textContent = file.name;

        const size = document.createElement('div');
        size.className = 'file-size';
        size.textContent = formatBytes(file.size);

        meta.appendChild(name);
        meta.appendChild(size);

        const actions = document.createElement('div');
        actions.className = 'file-actions';
        const btnRemove = document.createElement('button');
        btnRemove.type = 'button';
        btnRemove.title = 'Remover arquivo';
        btnRemove.className = 'icon-btn danger';
        btnRemove.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" style="color:var(--danger)"><path d="M6 18L18 6M6 6l12 12"/></svg>';
        btnRemove.addEventListener('click', () => {
          selectedFiles.splice(idx, 1);
          renderFilesList();
        });
        actions.appendChild(btnRemove);

        card.appendChild(thumb);
        card.appendChild(meta);
        card.appendChild(actions);

        filesGrid.appendChild(card);
      });
    }

    function formatBytes(bytes){
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B','KB','MB','GB','TB'];
      const i = Math.floor(Math.log(bytes)/Math.log(k));
      return (bytes / Math.pow(k, i)).toFixed(i ? 2 : 0) + ' ' + sizes[i];
    }

    async function startProcessing(){
      showProcessing();
      processingTitle.textContent = 'Enviando arquivos para processamento';
      processingSubtitle.textContent = 'Aguarde — enviando os arquivos para o serviço.';

      const fd = new FormData();
      selectedFiles.forEach((f, i) => fd.append(`file${i+1}`, f));
      
      // ✅ ADICIONA O TIPO DE RELATÓRIO
      fd.append('reportType', selectedReportType);

      const webhookURL = URLs[selectedReportType];

      try {
        const resp = await fetch(webhookURL, { method: 'POST', body: fd });

        if (!resp.ok) {
          const text = await resp.text().catch(()=> '');
          throw new Error(text || `Resposta do servidor: ${resp.status}`);
        }

        const blob = await resp.blob();
        
        const url = URL.createObjectURL(blob);
        objectUrl = url;
        
        const fileName = 'arquivo_processado';
        
        processedFile = { 
          url, 
          blob,
          fileName 
        };

        processingTitle.textContent = 'Concluído';
        processingSubtitle.textContent = 'Arquivo recebido com sucesso.';
        setTimeout(() => showResults(), 450);

      } catch (err){
        console.error('Erro no envio/recebimento:', err);
        processingTitle.textContent = 'Erro';
        processingSubtitle.textContent = 'Ocorreu um erro no processamento.';
        alert('Erro ao processar: ' + (err.message || err));
        showUpload();
      }
    }

    function showTypeSelection(){
      typeScreen.style.display = 'block';
      uploadScreen.style.display = 'none';
      processingScreen.style.display = 'none';
      resultsScreen.style.display = 'none';
    }

    function showUpload(){
      typeScreen.style.display = 'none';
      uploadScreen.style.display = 'block';
      processingScreen.style.display = 'none';
      resultsScreen.style.display = 'none';
    }

    function showProcessing(){
      typeScreen.style.display = 'none';
      uploadScreen.style.display = 'none';
      processingScreen.style.display = 'block';
      resultsScreen.style.display = 'none';
    }

    function showResults(){
      typeScreen.style.display = 'none';
      uploadScreen.style.display = 'none';
      processingScreen.style.display = 'none';
      resultsScreen.style.display = 'block';
      renderResults();
    }

    function renderResults(){
      resultsGrid.innerHTML = '';
      
      if (!processedFile){
        resultsTitle.textContent = 'Nenhum arquivo retornado';
        resultsSubtitle.textContent = 'Não foram encontrados arquivos após o processamento.';
        return;
      }

      resultsTitle.textContent = 'Processamento concluído';
      resultsSubtitle.textContent = 'Arquivo disponível para download';

      const item = document.createElement('div');
      item.className = 'result-item';

      const meta = document.createElement('div');
      meta.className = 'result-meta';

      const thumb = document.createElement('div');
      thumb.className = 'result-thumb';
      thumb.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>';

      const details = document.createElement('div');
      details.style.minWidth = '0';
      const name = document.createElement('div');
      name.className = 'result-name';
      name.title = processedFile.fileName;
      name.textContent = processedFile.fileName;
      const size = document.createElement('div');
      size.className = 'result-size';
      size.textContent = formatBytes(processedFile.blob.size);

      details.appendChild(name);
      details.appendChild(size);

      meta.appendChild(thumb);
      meta.appendChild(details);

      const actions = document.createElement('div');
      actions.style.display = 'flex';
      actions.style.gap = '8px';

      const dlBtn = document.createElement('button');
      dlBtn.className = 'btn primary';
      dlBtn.type = 'button';
      dlBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" style="color:currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="M7 10l5 5 5-5"/><path d="M12 15V3"/></svg><span class="btn-label">Download</span>';
      dlBtn.addEventListener('click', () => {
        const a = document.createElement('a');
        a.href = processedFile.url;
        a.download = processedFile.fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
      actions.appendChild(dlBtn);

      item.appendChild(meta);
      item.appendChild(actions);

      resultsGrid.appendChild(item);
    }

    function cleanupProcessed(){
      if (objectUrl) {
        URL.revokeObjectURL(objectUrl);
        objectUrl = null;
      }
    }

    window.addEventListener('beforeunload', () => cleanupProcessed());

    renderFilesList();
    showTypeSelection();
  </script>
</body>
</html>
